(function(){var t,n,e,o,s,c=function(t,n){function e(){this.constructor=t}for(var o in n)i.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;t=require("sublime-core"),e=require("stompjs"),o=require("shoe"),s={disconnected:{connect:function(t){var n;n=o(t.protocol+"://"+t.host+":"+t.port+"/stomp").sock,t.client=t.node?e.overTCP(t.host,t.port):e.over(n),t.client.connect(t.user,t.password,function(t){return function(){return t.setMachineState(t.connected)}}(this),function(t){return console.log(t)},t.vhost)}},connected:{disconnect:function(t){t.client.disconnect(function(n){return function(){return t.client=null,n.setMachineState(n.disconnected)}}(this))},subscribe:function(t,n,e){var o;t.channels[n]=t.channels[n]||[],o={subscription:t.client.subscribe(n,e),fn:e},t.channels[n].push(o)},unsubscribe:function(t,n,e){t.channels[n]&&(t.channels[n]=t.channels[n].filter(function(t){return t.fn===e&&t.subscription.unsubscribe(),t.fn!==e}),0===t.channels[n].length&&(t.channels[n]=null))},publish:function(t,n,e){"object"==typeof e&&(e=JSON.stringify(e)),t.client.send(n,{},e)}}},n=function(t){function n(t,e,o,c,i,r){n.__super__.constructor.call(this,s),this.user=t,this.password=e,this.host=o,this.port=c,this.protocol=i||"http",this.vhost=r||"/",this.channels={}}return c(n,t),n.prototype.connect=function(){return this.apply("connect",this)},n.prototype.disconnect=function(){return this.apply("disconnect",this)},n.prototype.subscribe=function(t,n){return this.apply("subscribe",this,t,n)},n.prototype.unsubscribe=function(t,n){return this.apply("unsubscribe",this,t,n)},n.prototype.publish=function(t,n){return this.apply("publish",this,t,n)},n}(t.Stateful),module.exports=n}).call(this);
