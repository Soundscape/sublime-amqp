(function(){var n,t,e,o,s,c=function(n,t){function e(){this.constructor=n}for(var o in t)i.call(t,o)&&(n[o]=t[o]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n},i={}.hasOwnProperty;n=require("sublime-core"),e=require("stompjs"),o=require("shoe"),s={disconnected:{connect:function(n){var t;t=o(n.protocol+"://"+n.host+":"+n.port+"/stomp").sock,n.client=n.node&&"undefined"==typeof window?e.overTCP(n.host,n.port):e.over(t),n.client.connect(n.user,n.password,function(n){return function(){return n.setMachineState(n.connected)}}(this),function(n){return console.log(n)},n.vhost)}},connected:{disconnect:function(n){n.client.disconnect(function(t){return function(){return n.client=null,t.setMachineState(t.disconnected)}}(this))},subscribe:function(n,t,e){var o;n.channels[t]=n.channels[t]||[],o={subscription:n.client.subscribe(t,e),fn:e},n.channels[t].push(o)},unsubscribe:function(n,t,e){n.channels[t]&&(n.channels[t]=n.channels[t].filter(function(n){return n.fn===e&&n.subscription.unsubscribe(),n.fn!==e}),0===n.channels[t].length&&(n.channels[t]=null))},publish:function(n,t,e){"object"==typeof e&&(e=JSON.stringify(e)),n.client.send(t,{},e)}}},t=function(n){function t(n,e,o,c,i,r){t.__super__.constructor.call(this,s),this.user=n,this.password=e,this.host=o,this.port=c,this.protocol=i||"http",this.vhost=r||"/",this.channels={}}return c(t,n),t.prototype.connect=function(){return this.apply("connect",this)},t.prototype.disconnect=function(){return this.apply("disconnect",this)},t.prototype.subscribe=function(n,t){return this.apply("subscribe",this,n,t)},t.prototype.unsubscribe=function(n,t){return this.apply("unsubscribe",this,n,t)},t.prototype.publish=function(n,t){return this.apply("publish",this,n,t)},t}(n.Stateful),module.exports=t}).call(this);